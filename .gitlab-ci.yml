stages:
  - backendtry
  - frontendtry

backend-build:
  stage: backendtry
  only:
    refs:
      - main
  before_script:
    - chmod +x ./frontend/.nuxt
    - chmod +x ./frontend/node_modules
  tags:
    - node
  script:
    - pm2 status
    - cd backend
    - npm install
    - pm2 delete "server_backend" 2> /dev/null || true
    - pm2 start npm --name "server_backend" -- run start

frontend-build:
  stage: frontendtry
  only:
    refs:
      - main
  tags:
   - vue
  script:
    - pm2 status
    - cd frontend
    - sudo npm set-script prepare ''
    - sudo npm install
    - sudo npm run build
    - pm2 delete "server_frontend" 2> /dev/null || true
    - pm2 start
